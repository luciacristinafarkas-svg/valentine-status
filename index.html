<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valentineâ€™s Status Check ğŸ’˜</title>
  <style>
    :root{
      --bg1:#0b1020; --bg2:#1a1033;
      --card: rgba(18, 27, 58, .70);
      --panel: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.10);
      --txt:#eef2ff; --muted:#b9c4ff;
      --accent:#ff4fd8; --accent2:#7c5cff;
      --ok:#33d17a; --warn:#ffb86b; --bad:#ff5b7a;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 18px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html, body { width:100%; }

    body{
      margin:0; min-height:100vh; color:var(--txt);
      background:
        radial-gradient(1200px 800px at 20% 10%, #2a1a55 0%, transparent 55%),
        radial-gradient(1200px 800px at 80% 90%, #3a1250 0%, transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center;
      padding: 28px;
      overflow-x:hidden;
    }

    @media (max-width: 480px){
      body{ padding: 14px; }
    }

    .wrap{ width:min(940px, 100%); min-width:0; }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px;
      backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
      min-width:0;
      transform: translateZ(0);
    }

    @media (max-width: 480px){
      .card{ padding: 16px; }
    }

    .spark{
      position:absolute; inset:-2px;
      border-radius: var(--radius);
      pointer-events:none;
      background:
        radial-gradient(650px 240px at 10% 0%, rgba(255,79,216,.20), transparent 60%),
        radial-gradient(650px 240px at 90% 100%, rgba(124,92,255,.18), transparent 60%);
      mix-blend-mode: screen;
      opacity:.9;
    }

    .top{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:16px; flex-wrap:wrap;
      position:relative;
      min-width:0;
    }

    h1{
      margin:0;
      font-size: clamp(26px, 3.2vw, 40px);
      letter-spacing:-.02em;
      line-height:1.06;
      display:flex; gap:10px; align-items:center;
      min-width:0;
    }

    .sub{
      margin:10px 0 0;
      color:var(--muted);
      font-size: clamp(14px, 1.4vw, 16px);
      max-width: 62ch;
    }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 13px;
      color: var(--muted);
      user-select:none;
      white-space:nowrap;
      max-width:100%;
      transition: transform .2s ease, background .2s ease;
    }

    .pill.pulse { animation: pillPulse 1.2s ease-in-out infinite; }
    @keyframes pillPulse {
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    .pill .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--txt);
      font-weight: 800;
      font-size: 12px;
    }

    .grid{
      margin-top:18px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
      position:relative;
      min-width:0;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    .panel{
      border-radius: var(--radius);
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 16px;
      min-width:0;
    }
    @media (max-width: 480px){
      .panel{ padding: 14px; }
    }

    .label{
      font-size:12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing:.12em;
      margin-bottom:10px;
      display:flex; align-items:center; gap:8px;
    }

    .big{
      font-size: clamp(20px, 2.2vw, 28px);
      line-height:1.25;
      font-weight: 800;
      margin: 6px 0 0;
      min-height: 2.6em; /* ca sÄƒ nu sarÄƒ layout-ul cÃ¢nd se schimbÄƒ textul */
    }

    .meter{
      margin-top:12px;
      height: 14px;
      background: rgba(255,255,255,.10);
      border-radius:999px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
    }
    .bar{
      height:100%;
      width: 8%;
      background: linear-gradient(90deg, var(--ok), var(--warn), var(--accent));
      border-radius:999px;
      transition: width .8s cubic-bezier(.2,.9,.2,1);
    }

    .ctaRow{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:14px;
      align-items:center;
    }

    button, a.btn{
      appearance:none;
      border:0;
      border-radius: 14px;
      padding: 12px 14px;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex; gap:10px; align-items:center;
      font-weight:800;
      min-width: 0;
    }

    @media (max-width: 520px){
      .ctaRow{ flex-direction:column; align-items:stretch; }
      .ctaRow button{ width:100%; justify-content:center; }
    }

    button.primary, a.primary{
      color:#0b1020;
      background: linear-gradient(135deg, var(--accent), #ff7ad9);
      box-shadow: 0 10px 30px rgba(255,79,216,.22);
      transition: transform .12s ease, filter .12s ease;
    }
    button.secondary, a.secondary{
      background: rgba(255,255,255,.10);
      color: var(--txt);
      border: 1px solid rgba(255,255,255,.14);
      font-weight:700;
      transition: transform .12s ease, filter .12s ease;
    }

    button:active, a.btn:active { transform: scale(.98); }
    @media (hover:hover){
      button:hover, a.btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
    }

    .note{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
    }

    .count{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top:12px;
      min-width:0;
    }
    @media (max-width: 520px){
      .count{ grid-template-columns: repeat(2, 1fr); }
    }

    .box{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 12px 10px;
      text-align:center;
      min-width:0;
    }

    .num{ font-size: 22px; font-weight: 900; }
    .unit{
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing:.12em;
      margin-top:4px;
    }
    @media (max-width: 360px){
      .num{ font-size: 20px; }
      .unit{ font-size: 10px; }
    }

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center; justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .overlay.show{ display:flex; }

    .modal{
      width:min(560px, 100%);
      background: rgba(18, 27, 58, .88);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      box-shadow: 0 25px 80px rgba(0,0,0,.55);
      backdrop-filter: blur(14px);
      overflow:hidden;
      position:relative;
      min-width:0;
    }
    .modalHeader{
      padding: 14px 16px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.10);
      gap:10px;
      min-width:0;
    }
    .modalTitle{
      font-weight:900;
      letter-spacing:-.01em;
      margin:0;
      display:flex; align-items:center; gap:10px;
      min-width:0;
    }
    .x{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--txt);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight:800;
      flex: 0 0 auto;
    }
    .modalBody{ padding: 16px; }
    .modalText{ color: var(--txt); font-size: 15px; line-height:1.5; margin:0 0 12px; }
    .modalActions{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    .mini{ color: var(--muted); font-size: 12px; margin-top: 10px; }

    /* Confetti */
    .confetti{ position:fixed; top:-10px; left:0; width:100%; height:0; pointer-events:none; z-index:60; }
    .piece{
      position:absolute; top:-20px;
      width:10px; height:16px;
      opacity:.95;
      animation: fall 1.8s linear forwards;
      border-radius: 3px;
    }
    @keyframes fall{
      to { transform: translateY(110vh) rotate(540deg); opacity:1; }
    }

    /* Hearts pop */
    .hearts{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .heart{
      position:absolute;
      font-size: 18px;
      opacity:.95;
      animation: floatUp 1.4s ease-out forwards;
      filter: drop-shadow(0 8px 20px rgba(255,79,216,.28));
    }
    @keyframes floatUp{
      from { transform: translateY(20px) scale(.9); opacity:.0; }
      20% { opacity:1; }
      to { transform: translateY(-120px) scale(1.15); opacity:0; }
    }

    /* Sad rain */
    .rain{
      position:fixed; inset:0;
      pointer-events:none;
      display:none;
      z-index:55;
    }
    .rain.show{ display:block; }
    .drop{
      position:absolute;
      top:-20px;
      width:2px;
      height:16px;
      background: rgba(185,196,255,.35);
      animation: rainFall 1.0s linear infinite;
      border-radius: 2px;
    }
    @keyframes rainFall{
      to { transform: translateY(120vh); opacity:.0; }
    }

    /* Tap hearts */
    .tapHeart{
      position: fixed;
      pointer-events:none;
      font-size: 18px;
      z-index: 80;
      animation: tapFloat 1.05s ease-out forwards;
      filter: drop-shadow(0 10px 22px rgba(255,79,216,.35));
    }
    @keyframes tapFloat{
      from { transform: translate(-50%, -20%) scale(.85); opacity:0; }
      15%  { opacity:1; }
      to   { transform: translate(-50%, -180%) scale(1.25); opacity:0; }
    }

    .muted{ color: var(--muted); }

/* Mood banner (sad / cute reactions) */
.mood{
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%) translateY(20px);
  width: min(560px, calc(100% - 28px));
  background: rgba(18, 27, 58, .88);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 16px;
  box-shadow: 0 18px 60px rgba(0,0,0,.45);
  backdrop-filter: blur(14px);
  padding: 12px 14px;
  display: none;
  z-index: 70;
}
.mood.show{ display:block; animation: moodIn .28s ease forwards; }
.mood.hide{ animation: moodOut .22s ease forwards; }
@keyframes moodIn{
  from{ opacity:0; transform: translateX(-50%) translateY(20px); }
  to  { opacity:1; transform: translateX(-50%) translateY(0px); }
}
@keyframes moodOut{
  from{ opacity:1; transform: translateX(-50%) translateY(0px); }
  to  { opacity:0; transform: translateX(-50%) translateY(16px); }
}

.moodTitle{ font-weight:900; letter-spacing:-.01em; margin:0 0 2px; }
.moodText{ margin:0; color: var(--muted); font-size: 13px; line-height:1.35; }
  
</style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="spark"></div>

      <div class="top">
        <div>
          <h1>ğŸš¨ Valentineâ€™s Status Check</h1>
         <p class="sub" id="subLine">ÃncÄƒ nu m-ai Ã®ntrebat dacÄƒ vreau sÄƒ fiu partenera ta ğŸ˜Œ</p>
        </div>
        <div class="pill" id="statusPill">status: pending</div>
      </div>

      <div class="grid">
        <!-- LEFT -->
        <div class="panel">
          <div class="label">CÃ¢t de aproape eÈ™ti sÄƒ o dai Ã®n barÄƒ?</div>
          <div class="big" id="urgencyText">Se calculeazÄƒâ€¦</div>

          <div class="meter" aria-label="progress meter">
            <div class="bar" id="bar"></div>
          </div>

          <div class="ctaRow">
            <button class="primary" id="btnInitiative">ğŸ˜¬ Oops, promit cÄƒ iau iniÈ›iativa</button>
            <button class="secondary" id="btnDone">ğŸ˜ Deja m-am ocupat</button>
          </div>

          <div class="note">Mic reminder: aÈ™ prefera sÄƒ nu fie pe ultima sutÄƒ de metri ğŸ™‚</div>
        </div>

        <!-- RIGHT -->
        <div class="panel">
          <div class="label">â³ Countdown</div>
          <div class="big">14 februarie</div>

          <div class="count" id="countdown">
            <div class="box"><div class="num" id="d">â€”</div><div class="unit">zile</div></div>
            <div class="box"><div class="num" id="h">â€”</div><div class="unit">ore</div></div>
            <div class="box"><div class="num" id="m">â€”</div><div class="unit">minute</div></div>
            <div class="box"><div class="num" id="s">â€”</div><div class="unit">secunde</div></div>
          </div>

          <div class="note">Nu-È›i cer â€œaziâ€. Doarâ€¦ sÄƒ Ã®ncepi â€œcurÃ¢ndâ€. ğŸ˜‰</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mood banner -->
  <div class="mood" id="mood" aria-live="polite"></div>

  <!-- Confetti + Rain layers -->
  <div class="confetti" id="confetti"></div>
  <div class="rain" id="rain"></div>

  <!-- MODAL -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalHeader">
        <h3 class="modalTitle" id="modalTitle">â€¦</h3>
        <button class="x" id="modalClose">âœ•</button>
      </div>
      <div class="modalBody">
        <p class="modalText" id="modalText"></p>
        <div class="modalActions" id="modalActions"></div>
        <div id="modalExtra"></div>
      </div>
      <div class="hearts" id="hearts"></div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("JS loaded âœ…");

  // ====== CONFIG ======
  const SMS_NUMBER = ""; // "+407xxxxxxxx" dacÄƒ vrei preset
  const TEXT_ROTATE_MS = 10000; // cÃ¢t timp rÄƒmÃ¢ne acelaÈ™i mesaj â€œCÃ¢t de aproapeâ€¦â€
  const TICK_MS = 300;          // countdown + bar fluid, dar fÄƒrÄƒ â€œspamâ€ la text

  // penalizÄƒri / recompense (ajusteazÄƒ cum vrei)
  const POINTS = {
    curiosity: +7,
    initiative: +3,
    admit_backlog: +8,
    send_message: +8,
    dinner_plan: +18,
    booked: +20,
    caught_lying: -25,   // AICI: scade mai mult
    small_lie_fee: -10
  };

  // ====== Target date: next Feb 14 at 18:00 local ======
  const now = new Date();
  const thisYear = now.getFullYear();
  let target = new Date(thisYear, 1, 14, 18, 0, 0);
  if (now > target) target = new Date(thisYear + 1, 1, 14, 18, 0, 0);

  // ====== DOM refs ======
  const statusPill = document.getElementById("statusPill");
  const urgencyText = document.getElementById("urgencyText");
  const bar = document.getElementById("bar");

  const dEl = document.getElementById("d");
  const hEl = document.getElementById("h");
  const mEl = document.getElementById("m");
  const sEl = document.getElementById("s");

  const btnInitiative = document.getElementById("btnInitiative");
  const btnDone = document.getElementById("btnDone");

  const overlay = document.getElementById("overlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalText = document.getElementById("modalText");
  const modalActions = document.getElementById("modalActions");
  const modalExtra = document.getElementById("modalExtra");
  const modalClose = document.getElementById("modalClose");
  const confetti = document.getElementById("confetti");
  const hearts = document.getElementById("hearts");
  const rain = document.getElementById("rain");


    // ====== First seen (pentru hook dinamic) ======
  const subLine = document.getElementById("subLine");
  const FIRST_SEEN_KEY = "firstSeenTs";

  let firstSeen = Number(localStorage.getItem(FIRST_SEEN_KEY) || "0");
  if (!firstSeen) {
    firstSeen = Date.now();
    localStorage.setItem(FIRST_SEEN_KEY, String(firstSeen));
  }

  function daysSince(ts){
    const ms = Date.now() - ts;
    return Math.max(0, Math.floor(ms / 86400000)); // 24*60*60*1000
  }

const days = daysSince(firstSeen);
if (subLine){
  subLine.textContent = days === 0
    ? "AstÄƒzi Ã®ncÄƒ nu m-ai Ã®ntrebat dacÄƒ vreau sÄƒ fiu partenera ta ğŸ˜Œ"
    : `Au trecut ${days} zile È™i Ã®ncÄƒ aÈ™tept Ã®ntrebarea aia.. ğŸ˜Œ`;
}



  
  // ====== cute state ======
  let romancePoints = Number(localStorage.getItem("romancePoints") || "0");
  let pillTaps = 0;
let dinnerLocked = localStorage.getItem("dinnerLocked") === "1";



let procrastinateCount = Number(sessionStorage.getItem("procrastinateCount") || "0");

function bumpProcrastinate(){
  procrastinateCount += 1;
  sessionStorage.setItem("procrastinateCount", String(procrastinateCount));
  return procrastinateCount;
}



  // state pentru textul â€œCÃ¢t de aproape...â€
  let lastVibeKey = "";
  let lastLine = "";
  let lastLineAt = 0;

  const LINES = {
    chill: [
      "ğŸ˜Œ Avem timp. Dar nu-l irosi cu â€œlasâ€™ cÄƒ mergeâ€.",
      "ğŸ™‚ E ok. Dar ai putea sÄƒ fii È™i mai cute azi.",
      "ğŸ˜ Ai timpâ€¦ dar eu am memorie bunÄƒ."
    ],
    mid: [
      "ğŸ˜ ÃncÄƒ e lejerâ€¦ dar vÄƒd cÄƒ Ã®È›i place suspansul.",
      "ğŸ™‚ E momentul perfect pentru un gest mic. Mic-mic.",
      "ğŸ«£ UÈ™or-uÈ™or intrÄƒm pe modul â€œhai cÄƒ fac mÃ¢ineâ€."
    ],
    late: [
      "ğŸ˜¬ Suntem fix Ã®n zona 'ultima sutÄƒ de metri'. Donâ€™t.",
      "ğŸ«£ Nu zic nimicâ€¦ doar mÄƒ uit la calendar.",
      "ğŸš¨ Bun. Acum chiar trebuie un plan."
    ],
    overtime: [
      "ğŸ˜¶ Too lateâ€¦ dar Ã®ncÄƒ poÈ›i salva situaÈ›ia.",
      "ğŸ¥² Ai intrat pe Hard Mode. Eu cred Ã®n tineâ€¦ cumva."
    ],
    roast: [
      "Sistemul detecteazÄƒ scuzele. Cu 99.9% acurateÈ›e. ğŸ¤–",
      "Am Ã®ntrebat calendarul. A rÃ¢s. ğŸ—“ï¸",
      "ÃÈ›i dau un hint: 'curÃ¢nd' nu Ã®nseamnÄƒ 'Ã®n 2029'. ğŸ˜‡"
    ]
  };

  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
  function format2(n){ return String(n).padStart(2, "0"); }

  function vibrate(ms=18){
    if ("vibrate" in navigator) navigator.vibrate(ms);
  }

  function badgeFromPoints(p){
    if (p >= 120) return "legend ğŸ’˜";
    if (p >= 70) return "solid ğŸ’–";
    if (p >= 30) return "decent ğŸ’—";
    return "pending ğŸ˜…";
  }

  function renderPill(text){
    const badge = badgeFromPoints(romancePoints);
    statusPill.innerHTML = `${text} <span class="badge">${romancePoints >= 0 ? "+" : ""}${romancePoints} Â· ${badge}</span>`;
  }

  function openModal({title, text, actions, extraHtml=""}){
    modalTitle.textContent = title;
    modalText.textContent = text;
    modalActions.innerHTML = "";
    modalExtra.innerHTML = extraHtml;

    actions.forEach(a => {
      const el = document.createElement(a.href ? "a" : "button");
      const cls = a.className || "";
      if (a.href) {
        el.href = a.href;
        el.className = `btn ${cls}`.trim();
        el.setAttribute("role", "button");
      } else {
        el.type = "button";
        el.className = cls;
      }
      el.textContent = a.label;
      if (a.onClick) el.addEventListener("click", a.onClick);
      modalActions.appendChild(el);
    });

    overlay.classList.add("show");
  }

  function closeModal(){
    overlay.classList.remove("show");
    hearts.innerHTML = "";
  }

  modalClose.addEventListener("click", closeModal);
  overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeModal(); });
  document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

  function confettiBurst(){
    const colors = ["#ff4fd8", "#7c5cff", "#33d17a", "#ffb86b", "#eef2ff"];
    const N = 120;
    for(let i=0;i<N;i++){
      const p = document.createElement("div");
      p.className = "piece";
      const x = Math.random()*100;
      const size = 6 + Math.random()*10;
      p.style.left = x + "vw";
      p.style.width = size + "px";
      p.style.height = (size*1.4) + "px";
      p.style.background = colors[Math.floor(Math.random()*colors.length)];
      p.style.animationDuration = (1.2 + Math.random()*1.4) + "s";
      p.style.transform = `rotate(${Math.random()*360}deg)`;
      confetti.appendChild(p);
      setTimeout(()=>p.remove(), 2500);
    }
  }

  function heartsPop(){
    const emojis = ["ğŸ’–","ğŸ’˜","ğŸ’—","ğŸ’","ğŸ’"];
    for (let i=0;i<14;i++){
      const h = document.createElement("div");
      h.className = "heart";
      h.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      h.style.left = (10 + Math.random()*80) + "%";
      h.style.top = (60 + Math.random()*30) + "%";
      h.style.animationDuration = (1.0 + Math.random()*0.8) + "s";
      hearts.appendChild(h);
      setTimeout(()=>h.remove(), 1600);
    }
  }

  function startRain(){
    rain.innerHTML = "";
    rain.classList.add("show");
    const drops = 80;
    for (let i=0;i<drops;i++){
      const d = document.createElement("div");
      d.className = "drop";
      d.style.left = (Math.random()*100) + "vw";
      d.style.animationDuration = (0.7 + Math.random()*0.9) + "s";
      d.style.animationDelay = (Math.random()*0.6) + "s";
      d.style.height = (10 + Math.random()*18) + "px";
      rain.appendChild(d);
    }
  }

  function stopRain(){
    rain.classList.remove("show");
    rain.innerHTML = "";
  }


  // Mood banner
const mood = document.getElementById("mood");

function showMood({title, text, ms=2400, rainOn=false}){
  if (!mood) return;
  if (rainOn) startRain();

  mood.innerHTML = `
    <div class="moodTitle">${title}</div>
    <p class="moodText">${text}</p>
  `;
  mood.classList.remove("hide");
  mood.classList.add("show");

  setTimeout(() => {
    mood.classList.remove("show");
    mood.classList.add("hide");
    setTimeout(() => {
      mood.classList.remove("hide");
      mood.style.display = "none";
      mood.style.display = ""; // reset
      // optional: rain stays on unless you stop it elsewhere
    }, 220);
  }, ms);
}

function cuteBoost(){
  heartsPop();
  showMood({
    title: "ğŸ«¶ AÈ™a te vreau!",
    text: "Puncte bonus pentru iniÈ›iativÄƒ. Sistemul aprobÄƒ. âœ…",
    ms: 1800,
    rainOn: false
  });
}
  function smsHref(body){
    const encoded = encodeURIComponent(body);
    if (SMS_NUMBER && SMS_NUMBER.trim().length > 0) return `sms:${encodeURIComponent(SMS_NUMBER)}&body=${encoded}`;
    return `sms:&body=${encoded}`;
  }

  // ====== Tap hearts anywhere ======
  function spawnTapHeart(x, y){
    const emojis = ["ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’—","ğŸ’","âœ¨"];
    const el = document.createElement("div");
    el.className = "tapHeart";
    el.textContent = pick(emojis);
    el.style.left = x + "px";
    el.style.top = y + "px";
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 1100);
  }
  document.addEventListener("pointerdown", (e)=>{
    if (e.target && e.target.id === "modalClose") return;
    spawnTapHeart(e.clientX, e.clientY);
  });

function setDinnerLocked(val){
  dinnerLocked = val;
  localStorage.setItem("dinnerLocked", val ? "1" : "0");
}


  // ====== Point system ======
   function addPoints(n){
    romancePoints = romancePoints + n;
    localStorage.setItem("romancePoints", String(romancePoints));
    renderPill(statusPillTextFromState()); // refresh badge

    // ====== Final unlock ======
    const FINAL_KEY = "finalUnlocked";
    if (romancePoints >= 120 && localStorage.getItem(FINAL_KEY) !== "1"){
      localStorage.setItem(FINAL_KEY, "1");
      confettiBurst();
      heartsPop();
      openModal({
        title: "ğŸ’˜ Final unlocked",
        text: "Ok. M-ai convins. RÄƒspunsul eâ€¦ da. ğŸ™‚",
        actions: [
          { label: "ğŸ«¶", className: "primary", onClick: () => closeModal() }
        ],
        extraHtml: `<div class="mini muted">Ai ajuns la 120+ points. EÈ™ti officially legend.</div>`
      });
    }
  }


  function statusPillTextFromState(){
    // pÄƒstrÄƒm textul curent din pill pÃ¢nÄƒ Ã®l actualizeazÄƒ update()
    // dar badge-ul se re-randeazÄƒ corect
    // (fallback dacÄƒ e gol)
    const raw = (statusPill.getAttribute("data-status") || "status: pending");
    return raw;
  }

  function setPillStatus(text, pulse=false){
    statusPill.setAttribute("data-status", text);
    renderPill(text);
    statusPill.classList.toggle("pulse", !!pulse);
  }

  // ====== date helpers for dinner plan ======
function nextDinnerInNext3DaysNotToday(h=19, m=30){
  const now = new Date();
  // mÃ¢ine / poimÃ¢ine / peste 3 zile (max)
  const options = [1,2,3].map(add => {
    const d = new Date(now);
    d.setDate(d.getDate() + add);
    d.setHours(h, m, 0, 0);
    return d;
  });

  // alegem primul care e Ã®n viitor (ar trebui sÄƒ fie mereu), dar pÄƒstrÄƒm logicÄƒ robustÄƒ
  return options.find(d => d > now) || options[0];
}

function formatRoDate(dt){
  const wd = ["DuminicÄƒ","Luni","MarÈ›i","Miercuri","Joi","Vineri","SÃ¢mbÄƒtÄƒ"][dt.getDay()];
  const dd = String(dt.getDate()).padStart(2,"0");
  const mm = String(dt.getMonth()+1).padStart(2,"0");
  const hh = String(dt.getHours()).padStart(2,"0");
  const mi = String(dt.getMinutes()).padStart(2,"0");
  return `${wd}, ${dd}.${mm} la ${hh}:${mi}`;
}


  // ====== smarter message rotation (fix for â€œmoves too fastâ€) ======
  function vibeKeyFromDays(days, overtime){
    if (overtime) return "overtime";
    if (days <= 2) return "critical";
    if (days <= 7) return "late";
    if (days <= 21) return "mid";
    return "chill";
  }

  function pickLineForVibe(vibeKey){
    if (vibeKey === "overtime") return pick(LINES.overtime);
    if (vibeKey === "critical") return pick(LINES.late);
    if (vibeKey === "late") return pick(LINES.late);
    if (vibeKey === "mid") return pick(LINES.mid);
    return pick(LINES.chill);
  }

  function update(){
    const now = new Date();
    const diff = target - now;

    if (diff <= 0){
      dEl.textContent = "00"; hEl.textContent = "00"; mEl.textContent = "00"; sEl.textContent = "00";
      bar.style.width = "100%";

      const vibeKey = "overtime";
      const shouldRotate = (vibeKey !== lastVibeKey) || (now - lastLineAt > TEXT_ROTATE_MS);
      if (shouldRotate){
        lastVibeKey = vibeKey;
        lastLine = pickLineForVibe(vibeKey);
        lastLineAt = now;
        urgencyText.textContent = lastLine;
      }

      setPillStatus("ğŸ§¨ status: overtime", true);
      return;
    }

    const totalSec = Math.floor(diff/1000);
    const days = Math.floor(totalSec / 86400);
    const hrs = Math.floor((totalSec % 86400) / 3600);
    const mins = Math.floor((totalSec % 3600) / 60);
    const secs = totalSec % 60;

    dEl.textContent = format2(days);
    hEl.textContent = format2(hrs);
    mEl.textContent = format2(mins);
    sEl.textContent = format2(secs);

    // meter: 0 at 30+ days, 100 at 0 days
    const meter = clamp(100 - (days/30)*100, 6, 100);
    bar.style.width = meter.toFixed(0) + "%";

    const vibeKey = vibeKeyFromDays(days, false);

    // actualizeazÄƒ mesajul rar: la schimbare de vibe sau o datÄƒ la TEXT_ROTATE_MS
    const shouldRotate = (vibeKey !== lastVibeKey) || (now - lastLineAt > TEXT_ROTATE_MS);
    if (shouldRotate){
      lastVibeKey = vibeKey;
      lastLine = pickLineForVibe(vibeKey);
      lastLineAt = now;
      urgencyText.textContent = lastLine;
    }

    // status pill text
    let vibeText = "warming up";
    let pulse = false;
    if (vibeKey === "chill") vibeText = "chill";
    if (vibeKey === "mid") vibeText = "warming up";
    if (vibeKey === "late") { vibeText = "last-minute risk"; pulse = true; }
    if (vibeKey === "critical") { vibeText = "CRITICAL"; pulse = true; }

    setPillStatus("status: " + vibeText, pulse);
if (dinnerLocked){
  setPillStatus("ğŸ status: dinner queued", true);
}
  
}

  // kickoff
  setPillStatus("status: pending", false);
  update();
  setInterval(update, TICK_MS);

  // ====== Easter egg on pill ======
  statusPill.addEventListener("click", () => {
    pillTaps++;
    vibrate(10);
    if (pillTaps >= 3){
      pillTaps = 0;
      addPoints(POINTS.curiosity);
      confettiBurst();
      openModal({
        title: "Secret mode unlocked âœ¨",
        text: pick(LINES.roast),
actions: [
  {
    label: "Ok, fair ğŸ˜‚",
    className: "primary",
    onClick: () => closeModal()
  },
  {
    label: "ğŸ”„ Reset dinner status",
    className: "secondary",
    onClick: () => {
      setDinnerLocked(false);   // ğŸ‘ˆ AICI
      closeModal();
    }
  }
],

        extraHtml: `<div class="mini muted">Ai primit +${POINTS.curiosity} romance points pentru curiozitate.</div>`
      });
    }
  });

  // ====== Button flows ======
  btnInitiative.addEventListener("click", () => {
    stopRain();
    vibrate(18);
    addPoints(POINTS.initiative);
cuteBoost();


    openModal({
      title: "Ok, letâ€™s seeâ€¦ ğŸ˜Œ",
      text: "Dar pÃ¢nÄƒ atunci: nu eÈ™ti cam Ã®n urmÄƒ cu gesturile romantice?",
      actions: [
        {
          label: "Ba da ... ğŸ™ƒ",
          className: "primary",
          onClick: () => {
            vibrate(18);
            addPoints(POINTS.admit_backlog);

            const dinnerDate = nextDinnerInNext3DaysNotToday(19, 30);
const dinnerText = `Ok, recunosc: am niÈ™te restanÈ›e la gesturi romantice ğŸ˜…
Azi nu pot (È™tiu, vin tÃ¢rziu)â€¦ dar Ã®n urmÄƒtoarele 3 zile repar:
${formatRoDate(dinnerDate)} Ã®È›i gÄƒtesc cina. 
È˜i ca sÄƒ fiu safe, fac È™i o rezervare â€œbackupâ€ la un loc drÄƒguÈ›. ğŸ’˜
Ce zici?
Dar pÃ¢nÄƒ atunci.. mÄƒ gÃ¢ndeam cÄƒ aÈ™ vrea sÄƒ Ã®È›i spun [cÄƒ sunt dragostea È™i fericirea ta ğŸ’–ğŸ’–ğŸ’–? È™i mai ceee?ğŸ‘€]`;


            openModal({
              title: "Bun. Progres. ğŸ˜Œ",
              text: "Alege o variantÄƒ concretÄƒ È™i eÈ™ti deja pe plus:",
              actions: [
                {
                  label: "Trimite mesaj drÄƒguÈ› ğŸ’¬",
                  className: "primary",
                  href: smsHref(dinnerText),
                  onClick: () => addPoints(POINTS.send_message)
                },
                {
  label: `ğŸ PregÄƒtesc cina (Ã®n urmÄƒtoarele 3 zile) + rezervare backup`,
  className: "secondary",
  onClick: () => {
    setDinnerLocked(true);          // ğŸ‘ˆ ASTA era Ã®ntrebarea ta
    addPoints(POINTS.dinner_plan);
    confettiBurst();
    heartsPop();
    closeModal();
  }
},

                {
                  label: "Ok, revin ğŸ˜…",
                  className: "secondary",
                  onClick: () => closeModal()
                }
              ],
              extraHtml: `
                <div class="mini muted">
                  Mini-plan (30 sec):<br/>
                  âœ… 1) confirmÄƒ ora<br/>
                  âœ… 2) Ã®ntreabÄƒ preferinÈ›e (â€œpaste? vedem ce pofta ai atunci?â€)<br/>
                  âœ… 3) pune Ã®n calendar (È™i chiar fÄƒ rezervarea backup ğŸ˜‡)
                </div>`
            });
          }
        },
        {
          label: "Nu ğŸ˜‡",
          className: "secondary",
          onClick: () => {
            vibrate(14);
            openModal({
              title: "Hahaâ€¦ nice try. ğŸ˜",
              text: "Cred cÄƒ poÈ›i mai mult. N-ai niciun gest mic pe care Ã®l poÈ›i face chiar acum?",
              actions: [
                {
                  label: "Ok, È™tiuâ€¦ ğŸ˜Œ",
                  className: "primary",
                  onClick: () => {
  addPoints(+5);
  closeModal();

  showMood({
    title: "ğŸ‘€ Sunt curioasÄƒâ€¦",
    text: "Bun. Atunci spune-mi: cum mÄƒ surprinzi? Ce declaraÈ›ie Ã®mi faci? ğŸ’­",
    ms: 2600,
    rainOn: false
  });

  heartsPop();
}

                },
                {
                  label: "MÄƒ mai gÃ¢ndesc ğŸ«£",
                  className: "secondary",
onClick: () => {
  closeModal();
  const n = bumpProcrastinate();

  if (n === 1){
    showMood({
      title: "ğŸ˜” Ofâ€¦",
      text: "Ok. AÈ™tept. Dar un pic de iniÈ›iativÄƒ m-ar fi fÄƒcut sÄƒ zÃ¢mbesc.",
      ms: 2600,
      rainOn: true
    });
  } else if (n === 2){
    showMood({
      title: "ğŸ¥² A doua oarÄƒ dejaâ€¦",
      text: "Calendarul meu a oftat. È˜i eu la fel. ğŸ™‚",
      ms: 2800,
      rainOn: true
    });
  } else if (n === 3){
    showMood({
      title: "ğŸš¨ Achievement unlocked: â€Procrastinatorâ€",
      text: "Ai deblocat nivelul 3 de amÃ¢nare. UrmÄƒtorul: scuze creative. ğŸ˜‡",
      ms: 3200,
      rainOn: false
    });
    // optional: penalizare micÄƒ
    addPoints(-3);
  } else {
    showMood({
      title: "ğŸ«  Ok, gata.",
      text: "DacÄƒ mai apeÈ™i o datÄƒ, Ã®È›i trimit eu invitaÈ›ia. Cu semnÄƒturÄƒ. ğŸ¤",
      ms: 3200,
      rainOn: false
    });
  }

  vibrate(12);
}

                }
              ]
            });
          }
        }
      ],
      extraHtml: `<div class="mini muted">Ai primit +${POINTS.initiative} points pentru iniÈ›iativÄƒ. (AÈ™a da.)</div>`
    });
  });

  btnDone.addEventListener("click", () => {
    stopRain();
    vibrate(18);

    openModal({
      title: "Hmmâ€¦ mai gÃ¢ndeÈ™te-te puÈ›inâ€¦ ğŸ¤¨",
      text: "EÈ™ti sigur cÄƒ â€œdeja te-ai ocupatâ€?",
      actions: [
        {
          label: "M-am gÃ¢ndit. Sunt sigur ğŸ˜",
          className: "primary",
          onClick: () => {
            stopRain();
            vibrate(28);
            addPoints(POINTS.booked);
            confettiBurst();
            heartsPop();
            openModal({
              title: "Ok. MÄƒ bucur. ğŸ’–",
              text: "D-abia aÈ™tept. (È˜i Ã®È›i apreciez curajul.)",
              actions: [
                { label: "Deal ğŸ¤", className: "primary", onClick: () => closeModal() }
              ],
              extraHtml: `<div class="mini muted">+${POINTS.booked} romance points. DacÄƒ minÈ›i, sistemul Ã®È›i ia serios. ğŸ˜‡</div>`
            });
          }
        },
        {
          label: "Ok, m-ai prins ğŸ¥²",
          className: "secondary",
          onClick: () => {
            startRain();
            vibrate(12);
            addPoints(POINTS.caught_lying);

            const dinnerDate = nextDinnerInNext3DaysNotToday(19, 30);
            const rescueText = `Okâ€¦ m-ai prins ğŸ˜…
Dar repar: ${formatRoDate(dinnerDate)} Ã®È›i gÄƒtesc cina. È˜i fac È™i o rezervare backup la un loc drÄƒguÈ›. ğŸ’˜
Ãmi dai voie sÄƒ mÄƒ revanÈ™ez?`;

            openModal({
              title: "Ofâ€¦ ğŸ˜¢",
              text: "Sunt tristÄƒ sÄƒ aud astaâ€¦ dar mÄƒcar nu-i timpul pierdut. ÃncÄƒ poÈ›i face ceva frumos.",
              actions: [
                {
                  label: "Trimit un mesaj acum ğŸ’¬",
                  className: "primary",
                  href: smsHref(rescueText),
                  onClick: () => addPoints(POINTS.send_message)
                },
{
  label: "Okâ€¦",
  className: "secondary",
  onClick: () => {
    closeModal();
    showMood({
      title: "ğŸ˜” Noted.",
      text: "AÈ™ fi preferat sÄƒ fie adevÄƒratâ€¦ dar mÄƒcar Ã®ncÄƒ putem salva momentul.",
      ms: 2600,
      rainOn: true
    });
    vibrate(14);
  }
}

              ],
              extraHtml: `<div class="mini muted">Penalty: ${POINTS.caught_lying} points. Data viitoare: adevÄƒrul din prima. ğŸ˜‡</div>`
            });
          }
        },
        {
          label: "Eehâ€¦ poate nu 100% ğŸ˜…",
          className: "secondary",
          onClick: () => {
            startRain();
            vibrate(10);
            addPoints(POINTS.small_lie_fee);
            openModal({
              title: "Apreciez sinceritateaâ€¦ cÃ¢t de cÃ¢t. ğŸ˜Œ",
              text: "Facem ceva rapid? Avem vreun mesaj? vreo propunere concretÄƒ?",
              actions: [
                { label: "Ok, fac acum ğŸ’¬", className: "primary", onClick: () => { closeModal(); } },
                {
  label: "Am Ã®nÈ›eles ğŸ˜…",
  className: "secondary",
  onClick: () => {
    closeModal();
    showMood({
      title: "ğŸ¥² Mhm.",
      text: "Okâ€¦ dar te rog: urmÄƒtoarea acÈ›iune sÄƒ fie realÄƒ. Nu doar vibe.",
      ms: 2400,
      rainOn: true
    });
    vibrate(10);
  }
}

              ],
              extraHtml: `<div class="mini muted">Penalty mic: ${POINTS.small_lie_fee} points. (Ai scÄƒpat uÈ™or.)</div>`
            });
          }
        }
      ],
      extraHtml: `<div class="mini muted">AtenÈ›ie: sistemul detecteazÄƒ minciuni prin vibraÈ›ii de â€œheheâ€.</div>`
    });
  });
});
</script>
</body>
</html>




